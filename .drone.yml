---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true
    commands:
      - npm ci

  - name: test
    image: node:12
    commands:
      - npm test

  #- name: check-coverage
  #  image: node:12
  #  commands:
  #    - npm run coverage

  - name: build
    image: node:12
    commands:
      - npm run build

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: I3k2YwirwX+5c3mU+DXGsE7qVsFJBJyeNP28Sv7HOFlKH+qiJqjZFwNg/QAl1J1RKioivcD4yLM6Cdp/tDm+6g==
---
kind: secret
name: ssh_key
data: Y3g6PzXEcM8OLVWD8k3/Bebgn7Ysi8u4gPh1xe40/o3gld0ofPLDTDd1CGr7t86541AcAw2/y0TMlZFcsWEfjyM3PQmVxd1FoIMnGTPrJLNkhDtfyx3y9+WAF/W8m2vd+Jbs2GHlLnXrpLvMoJyOq8O7cIImkBHpW8pbYJBWO1Wf/R7yKo7253hneEd3hMWHSY8T1fuaGMuf8v4ppBWfWPiGL49G/WnKCYnE9GvW3BZqZ56vMoSst+va2ZZ9TgSubkfdWk0rZx65k2hQDXIAoDX1XH3nrcpLd9h0ym1MEDDXerIJRRA49sX6illVEmnwFfAsXAMBFCeBdXdJf988T5YQ76B4J+PSSahmN+aiCkdxrVS7D5RaF34rMqhvs1KLHLysxS91tAIYYfoGs2ANLO+cRTWZRKAb/tNAgxmbijAQqWd2zstQtt7hCnrhBmUxUAbIw7KCahSJb0vUMbpSPKCIxWtEq4in8ENsg0cz4UjiH0oxpf2laCRcJN/9XWQ8ekGDH8Oug6GpU1R2bmBRS+NbE9vwsTNaP+SwmEFu1ubgiRbC7f17kkqvJ2LT4afdqLMxoYSvQtg5M77p0h9rUX/OqZDRoOCF9MPbroHc2HBRah2GS80vdmlZOAKSUu8WyflK4gVgSlhyeYNUwxLxlB6bFaxLFURaChFbivKanbS4RnJL1uVZn3TCWBMtQjmauuhA3/dBIXwT1nN1ckrLsTCx90aFmrjD3zkyw6+NCCSazPX4qSzHlN6UNakN0QXVKIdcD6au8FKdm7l+SGTXJWfLvjEnIGbwgPYXMjebrFYLW/i1Q6SQI1gbBPLdTBz0Ye3bUZIiofi2ivMjkX/xNLByqtv/jRUG6CctpDh/2dZfmsTQXKhkIa/BRhmHFXwnN81NBrabN7s1lPkZHlc5QqCyKqH5yP079hvZdki6Y3/n5itUmtMXfFT4/DANCn4eINfdJGckXWRQXwwzXD3T3hSHovJatLU/5kCz987OXDwdwtCZ+lnJP7+zoW4qPVO1QxtNonWDwHZjHW1gWcSf5is0VeTmPeS8M02jhuW1X+Noj6QT2m2vUbUj7uupdxjfvDcmgU/dD7R9l2seX85lbkmIt4SsilgoeOAJMWJxHRK/q4IXhLgrCq/z35P8Hb04KGAXVNgUNh0XUpOk5h/cE908AL57mEdVvMhPHrvxxk60hs2iWlQWU8rL1qekSQlBcYh31HARVMp+vY1X+jhKozJhy7yjsm77DV+dH7OBRTaSoFSXduIZA8kphdduP8QgXC6IarNKl/2aKKnh16LF5hIdXhdxc6AMaTB7bRiEfkFYZU3xX+rqJ+cg6JnNTFH/0Agy9p2MTAqojDraJkTvZ8TT8wKU7kdwc7CmAELW2Yvg3oeDHVWGt5kb54EdrtHmQwiGcPGe28pOlB5zK0NUaF5BHv1UZkweZ9fsUgOoIN4/9A4w6EbIWZ4WqXsTec8NrZmBXncMWaWs7wZwSmbl6NzQZeyLII+zvyMiGRu5koa91dneiTtBS3+JiUhfzAEwLI/Bhy143tkdg+fM6Atn1x3luz4teWetABHkQyc4wrcRNO+Cy39YQYHE2qJM11kLVUKaAujgUCXW6yjHBIHc2iCgqREWWtv18kdMJ7YV0i53LDhDJFcGxDH73ofHTMkFcisowZs+Dm1SzbGR/ITz1oDAskFyYO9+G4nKBeqGJmerFcvr2m0i/1fqWxbYG5znLs4/Y9bsH/gBqilQO1u3KoGAOGz0MlYm8UWrLv1qvux3SC9+3gcsDfVT0imakKzfeHg4t9GjTpX54WrskAgt0WeV+LOMl3Xc/X9X0kYS1WjEt7byx+YgcGS8ytd/7PY51hUeNsnc85k6e+/d2DSzduCBKfM0jhdEDFAJW0iU6Zp7yOKeomSKTU2hfGiVhjTpPdi1P8d+AJaMniegrS2T9XeZlo++G0kaKctZJ84Jpvsu0RgCZg0xwio+rRJS3NnyG6pr3l3/ffMu7jFMZxdFFSaFP78+U489Ky5+hwa9vdKUdjrcOTIksuvFpyCJZY2Ae7TX+Wt9LehYWCaNl00ZV7uqz7D30GzKaJkdS8FVtb3AuRmxAk7wr/tq+OoMeqe2xUsVVqz7PhxcZwkBabpqVc+r5T8ybncpwZfXoodgGtmfiQJWeRntRjDrrcWKXmiHrCojH3KL4+JNs+mnfx+l4ne/gQIERy3Mjk3K64KjPz6mG0q++cwh3dD/s4WTn12ctDCVr+Ln0/kcuIDQrFN+zRNZzm+TIDftC3oNkY/nuPXmjA7fz2vVCHEmj3XALGMy5GZsCSLArjXimA9QufEtdwujzEaR8jYq8v3iQoKD+3ndrBAWn8K8IX6j/4BTIrvJMG3sv0QZaEaVQ0bJGvEw1emnq5zJMf3tlFwYUP95baQspEFq180ErmwBxp7rLIoFpvs4WbDM0aH2YS+n/HhqM1JCP+9zNJFIQOTUo7X3LuOC4mgzaZf7ZjBQWoGcOtKplVvYKYBjalRpr98meGe/s4CS6/tAalXf1d5cOhB63qStxKj6v5RpdTyJwupnizAKKt/6Axi4U2UA26BazPXnPUboseOOsgtzygfEloyH4FE0iwoLq28H6RAYkhLiT9SrdZESpvLOiaiFS1klGuc7BNpiI47A5r4G/oD1113J3OaKODC07tXm+Yg3QmTCh96+xjMxLQxh8rU8+PXIYwuNcFsQjmGwHtDscdGNplt4Z0g1IGdPbsifA5lS47dxGmGDw+rMxs456zY4jjiNRaMciNjK5wC5HrpYRx5eJOV5jZ3kAOrCDAsxQcBV4eL6vTk7HfPTM93sUEY2A3LPKXt1+7OWSC1sQbsbGknMi+qBO5cN69pzfnidBVPivZBceHrKzWTAH+4taGVUxUW5M74g2uqOJ+mAOBxIWH8GqOzMScGhuXYS67lEy3j73Thf18VAPNhqCfd0zg44L+ItOpuJtCsG6ynMKOujtWEhe893NCxj73W+32z+cF+j8Ri6MrS45TYO2szeuYoPkic3
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: e02dfc7f7857b0b5d11ad309b6fdd62b045bee2cfd445c6ed2a7eb88ea5cf98f

...
